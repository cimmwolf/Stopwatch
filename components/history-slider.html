<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/paper-slider/paper-slider.html">
<link rel="import" href="date-behavior.html">

<dom-module id="history-slider">
    <template>
        {{formatTime(start)}}&ndash;{{formatTime(end)}} {{timeValue(start, end)}}
        <paper-slider id="slider" min="[[min]]" max="[[max]]" value="{{value}}"></paper-slider>
    </template>
    <script>
      class HistorySlider extends DateMixin(Polymer.Element) {
        static get is() {
          return 'history-slider';
        }

        static get properties() {
          return {
            start: Number,
            end: {
              type: Number,
              notify: true
            },
            min: {
              type: Number,
              value: 0
            },
            max: Number,
            value: Number
          }
        }

        static get observers() {
          return [
            'calcParams(start)'
          ]
        }

        disconnectedCallback() {
          super.disconnectedCallback();
          this.$.slider.removeEventListener('immediate-value-changed', this.valueBack.bind(this));
        }


        calcParams(start) {
          this.$.slider.removeEventListener('immediate-value-changed', this.valueBack.bind(this));
          let diff = this.end - start;
          this.max = diff;
          this.value = diff;
          this.$.slider.addEventListener('immediate-value-changed', this.valueBack.bind(this));
        }

        formatTime(seconds) {
          return moment(seconds * 60000).format('HH:mm');
        }

        timeValue(start, end) {
          if (start !== end) {
            return this.humanize((end - start) * 60000, 'meaning');
          } else {
            return '--';
          }
        }

        valueBack(e, details) {
          if (details.value != null) {
            return this.set('end', details.value + this.start);
          }
        }
      }

      customElements.define(HistorySlider.is, HistorySlider);
    </script>
</dom-module>
